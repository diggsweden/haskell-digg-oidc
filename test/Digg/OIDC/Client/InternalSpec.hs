{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE QuasiQuotes       #-}
module Digg.OIDC.Client.InternalSpec (spec) where

import           Data.Aeson                (decode, encode)
import           Data.Maybe                (fromJust)
import           Digg.OIDC.Client.Internal
import           Digg.OIDC.Types
import           Network.URI               (parseAbsoluteURI)
import           Test.Hspec
import           Data.String.Interpolation
import           Data.Aeson               (decode)
import           Jose.Jwt            (Jwt (..))

-- | Specification for testing the Digg OIDC Types module.
spec :: Spec
spec = do

  describe "Internal element functions" $ do

    it "isAnElementOf no match 1" $ do
        isAnElementOf 1 (Just [2,3,4]) `shouldBe` False

    it "isAnElementOf no match2" $ do
        isAnElementOf 1 Nothing `shouldBe` False

    it "isAnElementOf match" $ do
        isAnElementOf 1 (Just [1,2,3]) `shouldBe` True

  describe "TokensResponse JSON" $ do

    it "TokensResponse JSON encode verification" $ do
        decode jsonResponse `shouldBe` (Just tokensResponse)

tokensResponse :: TokensResponse
tokensResponse = TokensResponse   {
    tokensResponseAccessToken = Jwt {unJwt = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiSWJsbjZrRlc3Zk5BUkFYZ0Z5WldONWt2UlM2Z29USkVMSlQxVGRtX213In0.eyJleHAiOjE3MzQyNzM3MzgsImlhdCI6MTczNDI3MzQzOCwiYXV0aF90aW1lIjoxNzM0MjczNDM4LCJqdGkiOiIyZGIzMjc1Yy01N2M1LTQ4MGItYTMwYS1kNTQxODYzZjNhZmQiLCJpc3MiOiJodHRwczovL2dhbGF0ZWEuc3Rlbmx1bmQuZXUvYXV0aC9yZWFsbXMvdmVyaWZ5IiwiYXVkIjpbImhhc2tlbGwiLCJhY2NvdW50Il0sInN1YiI6IjdmYzViZWNkLWQ4MzAtNDYyMC04MzI0LTJmOGM1ZWRjYmJlMCIsInR5cCI6IkJlYXJlciIsImF6cCI6Imhhc2tlbGwiLCJzaWQiOiIxMGVmN2VjNy02MDE5LTQyZjgtOGNjNy1lMjZkZjJkM2VlOGEiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtdmVyaWZ5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7Imhhc2tlbGwiOnsicm9sZXMiOlsidGVzdGJlZGFkbWluIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIHRlc3RiZWQgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkFubmEgU3Rlbmx1bmQiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJhbm5hIiwiZ2l2ZW5fbmFtZSI6IkFubmEiLCJmYW1pbHlfbmFtZSI6IlN0ZW5sdW5kIiwiZW1haWwiOiJhbm5hLnN0ZW5sdW5kQHRlbGlhLmNvbSJ9.pKPNIB1LlirMNKWmsH4twig_v2uKYGt6O6j5V_KnmChzO2B2y2ROoehZ3XzLp3mCYluj7gTCJ9KoAqnCtAbTE_LE1jyu1kr6Mwgw9tQjSszOV6szYQYYWrJTqeymOLr-7ttEfrERjyVgJZBWxtaD8hmzwVQovFuy77o80Qd_Qa_lazYS7a6-EK123SLh0RZlKjm-tNCSVF-JUuCSc_VQlR43K5fwvIlZD-08bCEQkGDqBvXewPhbmD-YCE3scY4k7P5JBM6_ePBkbQ8M1uiwrG5MkAVPEQB7pF8oQbFz4mh2BLpbsyf_odBli83-XP850iybfo-ANRT5rbrVKuSydA"}
    , tokensResponseTokenType = "Bearer"
    , tokensResponseIdToken = Jwt { unJwt = "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiSWJsbjZrRlc3Zk5BUkFYZ0Z5WldONWt2UlM2Z29USkVMSlQxVGRtX213In0.eyJleHAiOjE3MzQyNzM3MzgsImlhdCI6MTczNDI3MzQzOCwiYXV0aF90aW1lIjoxNzM0MjczNDM4LCJqdGkiOiJiOGE0MzE1Yi1kZDJmLTQxNzctYTk2NC1kMWEwYjFiMzgxYmUiLCJpc3MiOiJodHRwczovL2dhbGF0ZWEuc3Rlbmx1bmQuZXUvYXV0aC9yZWFsbXMvdmVyaWZ5IiwiYXVkIjoiaGFza2VsbCIsInN1YiI6IjdmYzViZWNkLWQ4MzAtNDYyMC04MzI0LTJmOGM1ZWRjYmJlMCIsInR5cCI6IklEIiwiYXpwIjoiaGFza2VsbCIsIm5vbmNlIjoiL3d6czFaNWVzRlllUDdSK1RWZ1ZCc2xOTlMya1pxRnIzNVFabWlmMVZYUXFaTE9yYytPc2xwcjJlWkwrK3Y2dmRWNGtrV1RGQlJzclVQYlJlc3B0Unc9PSIsInNpZCI6IjEwZWY3ZWM3LTYwMTktNDJmOC04Y2M3LWUyNmRmMmQzZWU4YSIsImF0X2hhc2giOiJqYTFUSU4yMEhxX0M1WDhibU1jeFN3IiwiYWNyIjoiMSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiQW5uYSBTdGVubHVuZCIsInByZWZlcnJlZF91c2VybmFtZSI6ImFubmEiLCJnaXZlbl9uYW1lIjoiQW5uYSIsImZhbWlseV9uYW1lIjoiU3Rlbmx1bmQiLCJlbWFpbCI6ImFubmEuc3Rlbmx1bmRAdGVsaWEuY29tIn0.K5Hwv_fb0lGd8DCVjv3zUSSWqoWqncp73Qiu_n40gyb9WQWgxavDxPKuj8A2vBKtu0deAKSv1bxlVYMvvoIk3HApLEHeee8RZERGV4BliF_qGOmu3dHun5O96JhAUsHNC0016Vzqfkq0XRyRy-bpcaamYyG1u2Yw_VkHb5iGLbVCpkK7D-gmQtvGfvB7cgaSTTv1non2AKxSdYgdeXwPkWY3ShfvdZ5xuoepv1-_cj4N0A2fHieYtE_Yi3wSDhXM4V3q0AtxWUwzfCTB-fokDnyUOT82xp2u_Oa31xH5PMu6DrrvWtybNOJ6TmmMDEcyOZFJA8MCf-puBHWuXMlTWg"}
    , tokensResponseScope = Just ("openid profile testbed email")
    , tokensResponseExpiresIn = Just 300
    , tokensResponseRefreshToken = Just (Jwt {unJwt = "eyJhbGciOiJIUzUxMiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjMjk5MGRhMi1kOTgxLTQ1Y2MtOGM0My1kODQ0MzMzZDI4YTkifQ.eyJleHAiOjE3MzQyNzUyMzgsImlhdCI6MTczNDI3MzQzOCwianRpIjoiZTYwYWM0NmQtY2QxNy00ZGRmLThmMzEtNTQ1YzhhYmYwNjE3IiwiaXNzIjoiaHR0cHM6Ly9nYWxhdGVhLnN0ZW5sdW5kLmV1L2F1dGgvcmVhbG1zL3ZlcmlmeSIsImF1ZCI6Imh0dHBzOi8vZ2FsYXRlYS5zdGVubHVuZC5ldS9hdXRoL3JlYWxtcy92ZXJpZnkiLCJzdWIiOiI3ZmM1YmVjZC1kODMwLTQ2MjAtODMyNC0yZjhjNWVkY2JiZTAiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiaGFza2VsbCIsInNpZCI6IjEwZWY3ZWM3LTYwMTktNDJmOC04Y2M3LWUyNmRmMmQzZWU4YSIsInNjb3BlIjoib3BlbmlkIGJhc2ljIHdlYi1vcmlnaW5zIHByb2ZpbGUgdGVzdGJlZCBhY3IgZW1haWwgcm9sZXMiLCJyZXVzZV9pZCI6IjdiNWZjYTgxLWZmODAtNDg2OS1iZDdhLTI4OWIxYjk3NWY2MyJ9.WRI1diCEREAYYaQ5E9SK14W8PTIU5e5nvxwg6SJszNMOzzL97HEqZ6vRM9S53WcQiW5L4VHYd63Smo7g9yKEzg"})
  }

jsonResponse = [str|
{ "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiSWJsbjZrRlc3Zk5BUkFYZ0Z5WldONWt2UlM2Z29USkVMSlQxVGRtX213In0.eyJleHAiOjE3MzQyNzM3MzgsImlhdCI6MTczNDI3MzQzOCwiYXV0aF90aW1lIjoxNzM0MjczNDM4LCJqdGkiOiIyZGIzMjc1Yy01N2M1LTQ4MGItYTMwYS1kNTQxODYzZjNhZmQiLCJpc3MiOiJodHRwczovL2dhbGF0ZWEuc3Rlbmx1bmQuZXUvYXV0aC9yZWFsbXMvdmVyaWZ5IiwiYXVkIjpbImhhc2tlbGwiLCJhY2NvdW50Il0sInN1YiI6IjdmYzViZWNkLWQ4MzAtNDYyMC04MzI0LTJmOGM1ZWRjYmJlMCIsInR5cCI6IkJlYXJlciIsImF6cCI6Imhhc2tlbGwiLCJzaWQiOiIxMGVmN2VjNy02MDE5LTQyZjgtOGNjNy1lMjZkZjJkM2VlOGEiLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIioiXSwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbImRlZmF1bHQtcm9sZXMtdmVyaWZ5Iiwib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7Imhhc2tlbGwiOnsicm9sZXMiOlsidGVzdGJlZGFkbWluIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIHRlc3RiZWQgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkFubmEgU3Rlbmx1bmQiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJhbm5hIiwiZ2l2ZW5fbmFtZSI6IkFubmEiLCJmYW1pbHlfbmFtZSI6IlN0ZW5sdW5kIiwiZW1haWwiOiJhbm5hLnN0ZW5sdW5kQHRlbGlhLmNvbSJ9.pKPNIB1LlirMNKWmsH4twig_v2uKYGt6O6j5V_KnmChzO2B2y2ROoehZ3XzLp3mCYluj7gTCJ9KoAqnCtAbTE_LE1jyu1kr6Mwgw9tQjSszOV6szYQYYWrJTqeymOLr-7ttEfrERjyVgJZBWxtaD8hmzwVQovFuy77o80Qd_Qa_lazYS7a6-EK123SLh0RZlKjm-tNCSVF-JUuCSc_VQlR43K5fwvIlZD-08bCEQkGDqBvXewPhbmD-YCE3scY4k7P5JBM6_ePBkbQ8M1uiwrG5MkAVPEQB7pF8oQbFz4mh2BLpbsyf_odBli83-XP850iybfo-ANRT5rbrVKuSydA"
,"token_type": "Bearer"
,"id_token": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiSWJsbjZrRlc3Zk5BUkFYZ0Z5WldONWt2UlM2Z29USkVMSlQxVGRtX213In0.eyJleHAiOjE3MzQyNzM3MzgsImlhdCI6MTczNDI3MzQzOCwiYXV0aF90aW1lIjoxNzM0MjczNDM4LCJqdGkiOiJiOGE0MzE1Yi1kZDJmLTQxNzctYTk2NC1kMWEwYjFiMzgxYmUiLCJpc3MiOiJodHRwczovL2dhbGF0ZWEuc3Rlbmx1bmQuZXUvYXV0aC9yZWFsbXMvdmVyaWZ5IiwiYXVkIjoiaGFza2VsbCIsInN1YiI6IjdmYzViZWNkLWQ4MzAtNDYyMC04MzI0LTJmOGM1ZWRjYmJlMCIsInR5cCI6IklEIiwiYXpwIjoiaGFza2VsbCIsIm5vbmNlIjoiL3d6czFaNWVzRlllUDdSK1RWZ1ZCc2xOTlMya1pxRnIzNVFabWlmMVZYUXFaTE9yYytPc2xwcjJlWkwrK3Y2dmRWNGtrV1RGQlJzclVQYlJlc3B0Unc9PSIsInNpZCI6IjEwZWY3ZWM3LTYwMTktNDJmOC04Y2M3LWUyNmRmMmQzZWU4YSIsImF0X2hhc2giOiJqYTFUSU4yMEhxX0M1WDhibU1jeFN3IiwiYWNyIjoiMSIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJuYW1lIjoiQW5uYSBTdGVubHVuZCIsInByZWZlcnJlZF91c2VybmFtZSI6ImFubmEiLCJnaXZlbl9uYW1lIjoiQW5uYSIsImZhbWlseV9uYW1lIjoiU3Rlbmx1bmQiLCJlbWFpbCI6ImFubmEuc3Rlbmx1bmRAdGVsaWEuY29tIn0.K5Hwv_fb0lGd8DCVjv3zUSSWqoWqncp73Qiu_n40gyb9WQWgxavDxPKuj8A2vBKtu0deAKSv1bxlVYMvvoIk3HApLEHeee8RZERGV4BliF_qGOmu3dHun5O96JhAUsHNC0016Vzqfkq0XRyRy-bpcaamYyG1u2Yw_VkHb5iGLbVCpkK7D-gmQtvGfvB7cgaSTTv1non2AKxSdYgdeXwPkWY3ShfvdZ5xuoepv1-_cj4N0A2fHieYtE_Yi3wSDhXM4V3q0AtxWUwzfCTB-fokDnyUOT82xp2u_Oa31xH5PMu6DrrvWtybNOJ6TmmMDEcyOZFJA8MCf-puBHWuXMlTWg"
,"scope": "openid profile testbed email"
,"expires_in": "300"
,"refresh_token": "eyJhbGciOiJIUzUxMiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJjMjk5MGRhMi1kOTgxLTQ1Y2MtOGM0My1kODQ0MzMzZDI4YTkifQ.eyJleHAiOjE3MzQyNzUyMzgsImlhdCI6MTczNDI3MzQzOCwianRpIjoiZTYwYWM0NmQtY2QxNy00ZGRmLThmMzEtNTQ1YzhhYmYwNjE3IiwiaXNzIjoiaHR0cHM6Ly9nYWxhdGVhLnN0ZW5sdW5kLmV1L2F1dGgvcmVhbG1zL3ZlcmlmeSIsImF1ZCI6Imh0dHBzOi8vZ2FsYXRlYS5zdGVubHVuZC5ldS9hdXRoL3JlYWxtcy92ZXJpZnkiLCJzdWIiOiI3ZmM1YmVjZC1kODMwLTQ2MjAtODMyNC0yZjhjNWVkY2JiZTAiLCJ0eXAiOiJSZWZyZXNoIiwiYXpwIjoiaGFza2VsbCIsInNpZCI6IjEwZWY3ZWM3LTYwMTktNDJmOC04Y2M3LWUyNmRmMmQzZWU4YSIsInNjb3BlIjoib3BlbmlkIGJhc2ljIHdlYi1vcmlnaW5zIHByb2ZpbGUgdGVzdGJlZCBhY3IgZW1haWwgcm9sZXMiLCJyZXVzZV9pZCI6IjdiNWZjYTgxLWZmODAtNDg2OS1iZDdhLTI4OWIxYjk3NWY2MyJ9.WRI1diCEREAYYaQ5E9SK14W8PTIU5e5nvxwg6SJszNMOzzL97HEqZ6vRM9S53WcQiW5L4VHYd63Smo7g9yKEzg"
}
|]